<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/Iconos/Logo.ico') }}"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/login.css') }}"
    />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />

    <title>Inicio de Sesión</title>
  </head>
  <body>
    <a href="/" class="back-to-dashboard">
            <i class="bx bx-arrow-back"></i> Volver
          </a>
    <div class="container-form register hide">
      <div class="information">
        <div class="info-childs">
          <h2>Bienvenido</h2>
          <p>Si ya tienes una cuenta ingresa tus datos aqui:</p>
          <input type="button" value="Iniciar Sesión" id="sing-in" />
          <img
            src="{{ url_for('static', filename='images/Iconos/GatoLibros.png') }}"
            alt="Ilustración gato con libro"
            class="login-image"
          />
          
        </div>
      </div>

      <div class="form-information">
        <div class="form-information-childs">
          <h2>Crea una Cuenta</h2>
          <div class="icons">
            <i class="bx bxl-google"></i>
            <i class="bx bxl-github"></i>
            <i class="bx bxl-linkedin"></i>
          </div>
          <p>o usa tu email para registrarte</p>
          <form class="form" method="POST" action="/registro">
            <div class="form-grid">
              <label>
                <i class="bx bx-id-card"></i>
                <select name="tipo_documento" required>
                  <option value="" disabled selected>Tipo de Documento</option>
                  <option value="TI">T.I</option>
                  <option value="CC">C.C</option>
                  <option value="NIT">NIT</option>
                  <option value="PASAPORTE">Pasaporte</option>
                </select>
              </label>
              <label>
                <i class="bx bx-hash"></i>
                <input
                  type="text"
                  name="numero_documento"
                  placeholder="Número de Documento"
                  required
                />
              </label>
              <label>
                <i class="bx bx-user"></i>
                <input
                  type="text"
                  name="nombres"
                  placeholder="Nombres"
                  required
                />
              </label>
              <label>
                <i class="bx bx-user"></i>
                <input
                  type="text"
                  name="apellidos"
                  placeholder="Apellidos"
                  required
                />
              </label>
              <label>
                <i class="bx bx-calendar"></i>
                <input type="date" name="fecha_nacimiento" required />
              </label>
              <label>
                <i class="bx bx-male-female"></i>
                <select name="genero">
                  <option value="" disabled selected>Género (opcional)</option>
                  <option value="masculino">Masculino</option>
                  <option value="femenino">Femenino</option>
                </select>
              </label>
              <label>
                <i class="bx bx-home"></i>
                <input
                  type="text"
                  name="direccion"
                  placeholder="Dirección (opcional)"
                />
              </label>
              <label>
                <i class="bx bx-map"></i>
                <input
                  type="text"
                  name="ciudad"
                  placeholder="Ciudad (opcional)"
                />
              </label>
              <label>
                <i class="bx bx-phone"></i>
                <input
                  type="tel"
                  name="telefono"
                  placeholder="Teléfono (opcional)"
                />
              </label>
              <label>
                <i class="bx bx-envelope"></i>
                <input
                  type="email"
                  name="correo"
                  placeholder="Correo Electrónico"
                  required
                />
              </label>
              <label>
                <i class="bx bx-lock-alt"></i>
                <input
                  type="password"
                  id="password"
                  name="contraseña"
                  placeholder="Contraseña"
                  required
                />
                <i
                  class="bx bx-hide show_hide"
                  style="position: absolute; right: 15px; cursor: pointer"
                ></i>
              </label>
              <div class="password-strength-container">
                <div class="indicator">
                  <div class="icon-text">
                    <i class="bx bx-error-circle error_icon"></i>
                    <span class="text"></span>
                  </div>
                </div>
              </div>
            </div>
            <input type="submit" value="Registrarse" />
          </form>
        </div>
      </div>
    </div>

    <div class="container-form login">
      <div class="information">
        <div class="info-childs">
          <h2>Bienvenido</h2>
          <p>Si aún no tienes una cuenta por favor registrese aqui:</p>
          <input type="button" value="Registrarse" id="sing-up" />
          <img
            src="{{ url_for('static', filename='images/Iconos/GatoLibros.png') }}"
            alt="Ilustración gato con libro"
            class="login-image"
          />
        </div>
      </div>
      <div class="form-information">
        <div class="form-information-childs">
          <h2>Iniciar Sesión</h2>
          <div class="icons">
            <i class="bx bxl-google"></i>
            <i class="bx bxl-github"></i>
            <i class="bx bxl-linkedin"></i>
          </div>
          <p>o iniciar Sesión con una cuenta</p>
          <form class="form" method="POST" action="/login">
            <div
              id="login-error-message"
              style="
                display: none;
                color: #ff6333;
                margin-bottom: 10px;
                text-align: center;
              "
            ></div>
            <label>
              <i class="bx bx-envelope"></i>
              <input
                type="email"
                name="email"
                placeholder="Correo Electrónico"
                required
              />
            </label>
            <label>
              <i class="bx bx-lock-alt"></i>
              <input
                type="password"
                id="login-password"
                name="password"
                placeholder="Contraseña"
                required
              />
              <i
                class="bx bx-hide show_hide"
                style="position: absolute; right: 15px; cursor: pointer"
              ></i>
            </label>
            <!-- Agrega este enlace -->
            <a
              href="#"
              id="forgot-password"
              style="
                display: block;
                text-align: center;
                margin-top: 5px;
                color: #555;
                font-size: 0.8rem;
              "
              >¿Olvidaste tu contraseña?</a
            >

            <!-- Agrega este modal al final del body, antes del script -->
            <div
              id="password-recovery-modal"
              class="modal"
              style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                justify-content: center;
                align-items: center;
              "
            >
              <div
                class="modal-content"
                style="
                  background-color: #ede0d4;
                  padding: 20px;
                  border-radius: 10px;
                  width: 90%;
                  max-width: 400px;
                "
              >
                <span
                  class="close-modal"
                  style="float: right; cursor: pointer; font-size: 1.5rem"
                  >&times;</span
                >

                <!-- Paso 1: Ingresar email -->
                <div id="step-1">
                  <h3 style="margin-bottom: 15px">Recuperar contraseña</h3>
                  <p style="margin-bottom: 15px">
                    Ingresa tu correo electrónico para recibir un código de
                    verificación
                  </p>
                  <label
                    style="
                      display: block;
                      margin-bottom: 15px;
                      position: relative;
                    "
                  >
                    <i
                      class="bx bx-envelope"
                      style="
                        position: absolute;
                        left: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #555;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <input
                      type="email"
                      id="recovery-email"
                      name="email"
                      placeholder="Correo electrónico"
                      style="
                        width: 100%;
                        padding: 10px 15px 10px 45px;
                        border-radius: 20px;
                        border: none;
                        box-sizing: border-box;
                      "
                    />
                  </label>
                  <button
                    id="send-code-btn"
                    style="
                      background-color: #9191bd;
                      color: white;
                      border: none;
                      padding: 10px 20px;
                      border-radius: 20px;
                      cursor: pointer;
                      width: 100%;
                      margin-top: 10px;
                    "
                    type="button"
                  >
                    Enviar código
                  </button>
                </div>

                <!-- Paso 2: Ingresar código -->
                <div id="step-2" style="display: none">
                  <h3 style="margin-bottom: 15px">Verificación</h3>
                  <p style="margin-bottom: 15px">
                    Hemos enviado un código a tu correo electrónico. Por favor
                    ingrésalo a continuación.
                  </p>
                  <label
                    style="
                      display: block;
                      margin-bottom: 15px;
                      position: relative;
                    "
                  >
                    <i
                      class="bx bx-key"
                      style="
                        position: absolute;
                        left: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #555;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <input
                      type="text"
                      id="verification-code"
                      placeholder="Código de verificación"
                      style="
                        width: 100%;
                        padding: 10px 15px 10px 45px;
                        border-radius: 20px;
                        border: none;
                        box-sizing: border-box;
                      "
                    />
                  </label>
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                    "
                  >
                    <button
                      id="verify-code-btn"
                      style="
                        background-color: #9191bd;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 20px;
                        cursor: pointer;
                      "
                      type="button"
                    >
                      Verificar código
                    </button>
                    <a
                      href="#"
                      id="resend-code"
                      style="font-size: 0.8rem; color: #555"
                    >
                      Reenviar código
                    </a>
                  </div>
                </div>

                <!-- Paso 3: Nueva contraseña -->
                <div id="step-3" style="display: none">
                  <h3 style="margin-bottom: 15px">Nueva contraseña</h3>
                  <label
                    style="
                      display: block;
                      margin-bottom: 15px;
                      position: relative;
                    "
                  >
                    <i
                      class="bx bx-lock-alt"
                      style="
                        position: absolute;
                        left: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #555;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <input
                      type="password"
                      id="new-password"
                      placeholder="Nueva contraseña"
                      style="
                        width: 100%;
                        padding: 10px 15px 10px 45px;
                        border-radius: 20px;
                        border: none;
                        box-sizing: border-box;
                      "
                    />
                    <i
                      class="bx bx-hide show_hide"
                      style="
                        position: absolute;
                        right: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        cursor: pointer;
                        color: #555;
                      "
                    ></i>
                  </label>

                  <div class="password-strength-container">
                    <div class="indicator">
                      <div class="icon-text">
                        <i class="bx bx-error-circle error_icon"></i>
                        <span class="text"></span>
                      </div>
                    </div>
                  </div>

                  <label
                    style="
                      display: block;
                      margin-bottom: 15px;
                      position: relative;
                    "
                  >
                    <i
                      class="bx bx-lock-alt"
                      style="
                        position: absolute;
                        left: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #555;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <input
                      type="password"
                      id="confirm-password"
                      placeholder="Confirmar contraseña"
                      style="
                        width: 100%;
                        padding: 10px 15px 10px 45px;
                        border-radius: 20px;
                        border: none;
                        box-sizing: border-box;
                      "
                    />
                    <i
                      class="bx bx-hide show_hide"
                      style="
                        position: absolute;
                        right: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        cursor: pointer;
                        color: #555;
                      "
                    ></i>
                  </label>

                  <button
                    id="update-password-btn"
                    style="
                      background-color: #9191bd;
                      color: white;
                      border: none;
                      padding: 10px 20px;
                      border-radius: 20px;
                      cursor: pointer;
                      width: 100%;
                    "
                    type="button"
                  >
                    Actualizar contraseña
                  </button>
                </div>

                <div
                  id="recovery-message"
                  style="margin-top: 15px; color: #ff6333; display: none"
                ></div>
              </div>
            </div>
            <input type="submit" value="Iniciar Sesión" />
          </form>
        </div>
      </div>
    </div>
    <script>
      // Mostrar mensaje de logout
      const logoutMsg = localStorage.getItem("logoutMessage");
      if (logoutMsg) {
        Swal.fire({
          icon: "success",
          title: logoutMsg,
          showConfirmButton: false,
          timer: 2000,
          position: "top-end", // Evita que baje el scroll
          toast: true
        });
        localStorage.removeItem("logoutMessage");
      }

      // Transferir error de login del backend (si existe)
      {% if session['login_error'] %}
        sessionStorage.setItem("loginError", "{{ session['login_error'] }}");
        {% set _ = session.pop('login_error') %}
      {% endif %}

      // Mostrar error de login si está en sessionStorage
      const loginError = sessionStorage.getItem("loginError");
      if (loginError) {
        Swal.fire({
          icon: "error",
          title: "Error",
          text: loginError,
          confirmButtonText: "Aceptar",
          position: "top-end", // También aquí
          toast: true
        });
        sessionStorage.removeItem("loginError");
      }
    </script>
    <!-- Script principal -->
    <script src="{{ url_for('static', filename='js/login.js') }}"></script>
  </body>
</html>
